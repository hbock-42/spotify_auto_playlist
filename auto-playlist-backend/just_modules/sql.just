# SQL Type Generation Recipes
# ===========================

# Schema file location (managed by database project)
SCHEMA_PATH := "../database/.schemas_dump/schema.sql"

# Generate TypeScript types from SQL queries using sqlc
[group('sql')]
generate-types:
    @echo "ğŸ”§ Generating TypeScript types from SQL..."
    @if [ ! -f {{SCHEMA_PATH}} ]; then \
        echo "âŒ Schema file not found at {{SCHEMA_PATH}}"; \
        echo "ğŸ’¡ Run migrations in the database project first"; \
        exit 1; \
    fi
    @echo "âœ… Schema file found, generating types..."
    @sqlc generate
    @echo "âœ… TypeScript types generated!"

# Clean generated SQL TypeScript files
[group('sql')]
clean-types:
    @echo "ğŸ§¹ Cleaning generated TypeScript files..."
    @rm -rf src/generated/sqlc/*
    @echo "âœ… Generated types cleaned!"

# Check if schema file exists and show info
[group('sql')]
schema-status:
    @if [ -f {{SCHEMA_PATH}} ]; then \
        echo "âœ… Schema file exists: {{SCHEMA_PATH}}"; \
        echo "ğŸ“Š Tables found: $(grep -c "CREATE TABLE" {{SCHEMA_PATH}} 2>/dev/null || echo "0")"; \
        echo "ğŸ“ˆ Schema file size: $(wc -l < {{SCHEMA_PATH}} 2>/dev/null || echo "0") lines"; \
        echo "ğŸ• Last modified: $(stat -f %Sm {{SCHEMA_PATH}} 2>/dev/null || stat -c %y {{SCHEMA_PATH}} 2>/dev/null || echo "unknown")"; \
    else \
        echo "âŒ Schema file not found: {{SCHEMA_PATH}}"; \
        echo "ğŸ’¡ Make sure to run migrations in the database project"; \
        echo "ğŸ’¡ The database project should generate the schema automatically"; \
    fi

# Show help
[group('sql')]
sql-help:
    @echo "ğŸ—ƒï¸  SQL Type Generation Workflow:"
    @echo ""
    @echo "   ğŸ“Š schema-status    - Check schema file status"
    @echo "   ğŸ”§ generate-types   - Generate TypeScript from SQL queries"
    @echo "   ğŸ§¹ clean-types      - Clean generated TypeScript files"
    @echo ""
    @echo "ğŸ”„ Workflow:"
    @echo "   1. Run migrations in database project (generates {{SCHEMA_PATH}})"
    @echo "   2. Run 'just generate-types' to create TypeScript types"
    @echo ""
    @echo "ğŸ’¡ After modifying SQL queries: just generate-types"
    @echo "ğŸ’¡ After database migrations: database project auto-updates schema"
    @echo ""
    @echo "ğŸ”§ Requirements:"
    @echo "   - sqlc installed for TypeScript generation"
    @echo "   - Schema file at {{SCHEMA_PATH}} (managed by database project)"

# IMPORTANT: Reminder rule for TypeScript operations
[group('sql')]
remind-sql-gen:
    @echo "ğŸ’¡ REMINDER: If you modified SQL queries:"
    @echo "   Run 'just generate-types' to regenerate TypeScript types"
    @echo "   Schema updates are handled automatically by the database project"